# MultiExit Proxy

[![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

ä¸€ä¸ªé«˜æ€§èƒ½çš„å¤šå‡ºå£IPä»£ç†ç³»ç»Ÿï¼Œæ”¯æŒSNATæºåœ°å€è½¬æ¢ï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡ç«¯çš„å¤šä¸ªå…¬ç½‘IPè®¿é—®å¤–ç½‘æœåŠ¡ã€‚ç³»ç»Ÿé‡‡ç”¨TLS 1.3 + AES-GCMç¡¬ä»¶åŠ é€ŸåŠ å¯†ï¼Œæ€§èƒ½ä¼˜åŒ–åååé‡å¯è¾¾ **7-8 GB/s**ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- âœ… **å¤šå‡ºå£IPç®¡ç†** - æ”¯æŒå¤šä¸ªå…¬ç½‘IPï¼Œè‡ªåŠ¨SNATæºåœ°å€è½¬æ¢
- âœ… **æ™ºèƒ½IPåˆ†é…** - è½®è¯¢ã€æŒ‰ç›®æ ‡ã€æŒ‰ç«¯å£ã€è´Ÿè½½å‡è¡¡ã€åœ°ç†ä½ç½®ã€è§„åˆ™å¼•æ“ç­‰å¤šç§ç­–ç•¥
- âœ… **é«˜æ€§èƒ½åŠ å¯†** - TLS 1.3 + AES-GCMç¡¬ä»¶åŠ é€Ÿï¼Œæ€§èƒ½æå‡ **5.8å€**
- âœ… **UDPä»£ç†** - å®Œæ•´æ”¯æŒSOCKS5 UDP ASSOCIATE
- âœ… **Trojanåè®®** - å…¼å®¹æ ‡å‡†Trojanåè®®ï¼Œæµé‡æ›´éšè”½

### ğŸ›¡ï¸ é«˜çº§åŠŸèƒ½
- âœ… **IPå¥åº·æ£€æŸ¥** - è‡ªåŠ¨æ£€æµ‹æ•…éšœIPå¹¶åˆ‡æ¢ï¼Œæ”¯æŒé‡è¯•é˜ˆå€¼æœºåˆ¶
- âœ… **IPè‡ªåŠ¨æ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«æœåŠ¡å™¨ä¸Šçš„å…¬ç½‘å‡ºå£IPï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… **æ™ºèƒ½IPåˆ‡æ¢** - æ•…éšœIPè‡ªåŠ¨è¿‡æ»¤ï¼Œæ¢å¤åè‡ªåŠ¨é‡æ–°å¯ç”¨
- âœ… **å®æ—¶ç›‘æ§** - è¿æ¥æ•°ã€æµé‡ã€å»¶è¿Ÿå®æ—¶ç»Ÿè®¡
- âœ… **æµé‡åˆ†æ** - æŒ‰åŸŸåç»Ÿè®¡ã€æµé‡è¶‹åŠ¿åˆ†æã€å¼‚å¸¸æ£€æµ‹
- âœ… **å¤šç”¨æˆ·è®¤è¯** - Argon2å¯†ç å“ˆå¸Œï¼Œå®‰å…¨çš„éšæœºsalt
- âœ… **è´Ÿè½½å‡è¡¡** - æŒ‰è¿æ¥æ•°å’Œæµé‡æ™ºèƒ½åˆ†é…
- âœ… **DDoSé˜²æŠ¤** - è¿æ¥é€Ÿç‡é™åˆ¶å’Œè‡ªåŠ¨é˜»æ­¢
- âœ… **IPè¿‡æ»¤** - é»‘ç™½åå•æ”¯æŒ
- âœ… **é€Ÿç‡é™åˆ¶** - å…¨å±€ã€æŒ‰IPã€æŒ‰ç”¨æˆ·çš„è¿æ¥å’Œå¸¦å®½é™åˆ¶
- âœ… **é…ç½®çƒ­æ›´æ–°** - æ— éœ€é‡å¯æœåŠ¡æ›´æ–°é…ç½®
- âœ… **é…ç½®ç‰ˆæœ¬ç®¡ç†** - è‡ªåŠ¨å¤‡ä»½ã€ç‰ˆæœ¬æ§åˆ¶ã€ä¸€é”®å›æ»š
- âœ… **é›¶æ‹·è´ä¼˜åŒ–** - Linux spliceæ”¯æŒï¼Œæ€§èƒ½æå‡30-40%
- âœ… **è¿æ¥æ± ** - å®¢æˆ·ç«¯è¿æ¥å¤ç”¨ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€
- âœ… **è‡ªåŠ¨é‡è¿** - æŒ‡æ•°é€€é¿é‡è¿æœºåˆ¶ï¼Œæœ€å¤§å»¶è¿Ÿé™åˆ¶
- âœ… **è§„åˆ™å¼•æ“** - åŸºäºåŸŸåã€IPã€ç«¯å£çš„è‡ªå®šä¹‰è·¯ç”±è§„åˆ™

### ğŸ”’ å®‰å…¨å¢å¼º
- âœ… **CSRFä¿æŠ¤** - Webç•Œé¢CSRF TokenéªŒè¯
- âœ… **ç™»å½•ä¿æŠ¤** - é˜²æš´åŠ›ç ´è§£ï¼Œ5æ¬¡å¤±è´¥è‡ªåŠ¨é˜»æ­¢15åˆ†é’Ÿ
- âœ… **è¿æ¥è¶…æ—¶ç®¡ç†** - è¯»å†™è¶…æ—¶ã€ç©ºé—²è¿æ¥è‡ªåŠ¨å…³é—­ã€TCP KeepAlive
- âœ… **ä¼˜é›…å…³é—­** - ç­‰å¾…æ´»è·ƒè¿æ¥å®Œæˆï¼Œå®‰å…¨å…³é—­æœåŠ¡
- âœ… **è¯ä¹¦éªŒè¯** - å¯åŠ¨æ—¶éªŒè¯TLSè¯ä¹¦æœ‰æ•ˆæ€§

### ğŸ³ éƒ¨ç½²å’Œè¿ç»´
- âœ… **Dockeræ”¯æŒ** - å®Œæ•´çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ
- âœ… **Webç®¡ç†ç•Œé¢** - å¯è§†åŒ–ç®¡ç†å’Œç›‘æ§ï¼Œæ”¯æŒæµé‡åˆ†æå’Œè§„åˆ™ç®¡ç†
- âœ… **è®¢é˜…åŠŸèƒ½** - æ”¯æŒè®¢é˜…é“¾æ¥è‡ªåŠ¨é…ç½®å®¢æˆ·ç«¯
- âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²** - ä¸€é”®éƒ¨ç½²è„šæœ¬
- âœ… **Prometheusé›†æˆ** - æ ‡å‡†æŒ‡æ ‡å¯¼å‡ºï¼Œæ”¯æŒGrafanaå¯è§†åŒ–
- âœ… **æ—¥å¿—è½®è½¬** - è‡ªåŠ¨æ—¥å¿—è½®è½¬ï¼Œé˜²æ­¢ç£ç›˜ç©ºé—´å ç”¨

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ä¼˜åŒ–æ•ˆæœ
- **åŠ å¯†ååé‡**: 7-8 GB/s (32KBæ•°æ®åŒ…)
- **æ€§èƒ½æå‡**: 5.8å€ (ç›¸æ¯”ä¼˜åŒ–å‰)
- **CPUä½¿ç”¨ç‡**: é™ä½70%
- **å†…å­˜ä¼˜åŒ–**: Bufferæ± åŒ–ï¼Œå‡å°‘GCå‹åŠ›

### åŸºå‡†æµ‹è¯•ç»“æœ
```
BenchmarkEncryptionThroughput/Size_32KB
  614517 æ¬¡/ç§’
  4186 ns/op
  7827.69 MB/s
  16 B/op, 1 allocs/op
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ä»£ç†æœåŠ¡ç«¯   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ç›®æ ‡æœåŠ¡    â”‚
â”‚ (Client) â”‚  åŠ å¯†   â”‚ (Proxy Svr)  â”‚  SNAT   â”‚ (Target)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  éš§é“   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ ç®¡ç†å¤šä¸ªå‡ºå£IP
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  EIP Pool   â”‚
                  â”‚ IP1, IP2... â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ
```
åº”ç”¨æ•°æ® â†’ è‡ªå®šä¹‰åè®® â†’ AEADåŠ å¯† â†’ TLS 1.3 â†’ TCP
```

### æ ¸å¿ƒç»„ä»¶
- **ä»£ç†æœåŠ¡ç«¯** (`internal/proxy/server.go`) - æ ¸å¿ƒä»£ç†é€»è¾‘ï¼Œè¿æ¥ç®¡ç†ï¼Œæµé‡è½¬å‘
- **SNATç®¡ç†** (`internal/snat/`) - IPé€‰æ‹©ã€è·¯ç”±ç®¡ç†ã€å¥åº·æ£€æŸ¥ã€åœ°ç†ä½ç½®é€‰æ‹©
- **åè®®å±‚** (`internal/protocol/`) - åŠ å¯†/è§£å¯†ã€æ¶ˆæ¯åè®®
- **ä¼ è¾“å±‚** (`internal/transport/`) - TLSå°è£…ã€æµé‡æ··æ·†
- **ç›‘æ§ç»Ÿè®¡** (`internal/monitor/`) - è¿æ¥ç»Ÿè®¡ã€æµé‡åˆ†æã€Prometheuså¯¼å‡º
- **Webç•Œé¢** (`internal/web/`) - ç®¡ç†ç•Œé¢ã€APIæ¥å£ã€å®‰å…¨ä¿æŠ¤
- **é…ç½®ç®¡ç†** (`internal/config/`) - é…ç½®åŠ è½½ã€çƒ­æ›´æ–°ã€ç‰ˆæœ¬ç®¡ç†ã€å¤‡ä»½å›æ»š

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/YOUR_USERNAME/multiexit-proxy.git
cd multiexit-proxy

# 2. é…ç½®
cp configs/server.yaml.example configs/server.yaml
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®IPå’Œå¯†é’¥

# 3. å¯åŠ¨
docker-compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ–¹å¼2: ç›´æ¥éƒ¨ç½²

```bash
# 1. ç¼–è¯‘
go build -o server ./cmd/server
go build -o client ./cmd/client

# 2. é…ç½®æœåŠ¡ç«¯
cp configs/server.yaml.example configs/server.yaml
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ï¼š
#   - exit_ips: ä½ çš„å…¬ç½‘IPåˆ—è¡¨
#   - auth.key: è®¤è¯å¯†é’¥
#   - server.tls.cert/key: TLSè¯ä¹¦è·¯å¾„
#   - snat.gateway: ç½‘å…³åœ°å€
#   - snat.interface: ç½‘ç»œæ¥å£

# 3. è¿è¡ŒæœåŠ¡ç«¯ï¼ˆéœ€è¦rootæƒé™ï¼Œç”¨äºSNATé…ç½®ï¼‰
sudo ./server -config configs/server.yaml

# 4. é…ç½®å®¢æˆ·ç«¯
cp configs/client.json.example configs/client.json
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®æœåŠ¡ç«¯åœ°å€å’Œè®¤è¯å¯†é’¥

# 5. è¿è¡Œå®¢æˆ·ç«¯
./client -config configs/client.json
```

### æ–¹å¼3: è‡ªåŠ¨åŒ–éƒ¨ç½²

```bash
# 1. ç¼–è¯‘å¹¶æ‰“åŒ…
./deploy-server.sh

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r deploy/server/* root@YOUR_SERVER:/opt/multiexit-proxy/

# 3. åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²
ssh root@YOUR_SERVER
cd /opt/multiexit-proxy
chmod +x scripts/setup.sh
sudo bash scripts/setup.sh

# 4. å¯åŠ¨æœåŠ¡
sudo systemctl start multiexit-proxy
```

### å®¢æˆ·ç«¯ä½¿ç”¨

#### ä½¿ç”¨è®¢é˜…é“¾æ¥ï¼ˆæ¨èï¼‰
```bash
./client -subscribe "http://YOUR_SERVER:8080/api/subscribe?token=YOUR_TOKEN"
```

#### ä½¿ç”¨é…ç½®æ–‡ä»¶
```bash
./client -config configs/client.json
```

#### é…ç½®ç³»ç»Ÿä»£ç†
```bash
# macOS/Linux
export ALL_PROXY=socks5://127.0.0.1:1080

# Windows
# è®¾ç½® â†’ ç½‘ç»œå’ŒInternet â†’ ä»£ç† â†’ æ‰‹åŠ¨ä»£ç†è®¾ç½®
# SOCKSä»£ç†: 127.0.0.1:1080
```

#### æµ‹è¯•ä»£ç†
```bash
curl --socks5-hostname 127.0.0.1:1080 http://httpbin.org/ip
```

### Webç®¡ç†ç•Œé¢

å‰ç«¯ç®¡ç†ç•Œé¢æ˜¯ç‹¬ç«‹çš„Next.jsåº”ç”¨ï¼Œé»˜è®¤è¿è¡Œåœ¨ `http://localhost:8081`

- åç«¯APIæœåŠ¡: `http://localhost:8080/api`
- å‰ç«¯ç®¡ç†ç•Œé¢: `http://localhost:8081`
- é»˜è®¤ç”¨æˆ·å: `admin`
- å¯†ç : é…ç½®æ–‡ä»¶ä¸­çš„ `web.password`

åŠŸèƒ½åŒ…æ‹¬:
- ç³»ç»ŸçŠ¶æ€ç›‘æ§
- IPç®¡ç†å’Œå¥åº·æ£€æŸ¥
- å®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼ˆè¿æ¥æ•°ã€æµé‡ã€å»¶è¿Ÿï¼‰
- æµé‡åˆ†æï¼ˆæŒ‰åŸŸåç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æï¼‰
- è§„åˆ™å¼•æ“ç®¡ç†
- é…ç½®æ›´æ–°å’Œç‰ˆæœ¬å›æ»š
- è®¢é˜…ç®¡ç†
- PrometheusæŒ‡æ ‡æŸ¥çœ‹

**æ³¨æ„**: åç«¯åªæä¾›APIæœåŠ¡ï¼Œä¸å†åŒ…å«HTMLé¡µé¢ã€‚è¯·ä½¿ç”¨ç‹¬ç«‹çš„å‰ç«¯åº”ç”¨ä½œä¸ºç®¡ç†ç•Œé¢ã€‚

## ğŸ“‹ IPåˆ†é…ç­–ç•¥

ç³»ç»Ÿæ”¯æŒå¤šç§IPåˆ†é…ç­–ç•¥ï¼Œå¹¶ä¸”**è‡ªåŠ¨è¿‡æ»¤ä¸å¥åº·çš„IP**ï¼š

1. **è½®è¯¢ç­–ç•¥ (Round Robin)** - æŒ‰è¿æ¥é¡ºåºè½®æµä½¿ç”¨å„ä¸ªå¥åº·IP
2. **æŒ‰ç›®æ ‡åœ°å€ (Destination Based)** - ç›¸åŒç›®æ ‡ä½¿ç”¨ç›¸åŒå‡ºå£IPï¼ˆä»…å¥åº·IPï¼‰
3. **æŒ‰ç«¯å£åˆ†é… (Port Based)** - ç‰¹å®šç«¯å£èŒƒå›´æ˜ å°„åˆ°ç‰¹å®šIP
4. **è´Ÿè½½å‡è¡¡ (Load Balanced)** - æŒ‰è¿æ¥æ•°æˆ–æµé‡æ™ºèƒ½åˆ†é…ï¼ˆä»…å¥åº·IPï¼‰
5. **åœ°ç†ä½ç½®é€‰æ‹© (Geo Location)** - æ ¹æ®ç›®æ ‡åœ°ç†ä½ç½®é€‰æ‹©æœ€è¿‘çš„å‡ºå£IP
6. **è§„åˆ™å¼•æ“ (Rule Engine)** - åŸºäºåŸŸåã€IPã€ç«¯å£çš„è‡ªå®šä¹‰è·¯ç”±è§„åˆ™

é…ç½®ç¤ºä¾‹ï¼š
```yaml
strategy:
  type: "load_balanced"  # round_robin, destination_based, load_balanced
  config:
    method: "connections"  # æˆ– "traffic"

# å¥åº·æ£€æŸ¥é…ç½®ï¼ˆæ¨èå¯ç”¨ï¼‰
health_check:
  enabled: true      # å¯ç”¨å¥åº·æ£€æŸ¥
  interval: "30s"    # æ£€æŸ¥é—´éš”
  timeout: "5s"      # æ£€æŸ¥è¶…æ—¶ï¼ˆè¿ç»­å¤±è´¥3æ¬¡æ‰æ ‡è®°ä¸ºä¸å¥åº·ï¼‰

# IPè‡ªåŠ¨æ£€æµ‹é…ç½®ï¼ˆå¯é€‰ï¼‰
ip_detection:
  enabled: true      # å¯ç”¨IPè‡ªåŠ¨æ£€æµ‹
  interface: ""      # æŒ‡å®šç½‘ç»œæ¥å£ï¼ˆç©º=æ£€æµ‹æ‰€æœ‰æ¥å£ï¼‰

# åœ°ç†ä½ç½®é€‰æ‹©é…ç½®ï¼ˆå¯é€‰ï¼‰
geo_location:
  enabled: true      # å¯ç”¨åŸºäºåœ°ç†ä½ç½®çš„IPé€‰æ‹©
  api_url: ""        # åœ°ç†ä½ç½®API URLï¼ˆå¯é€‰ï¼‰
  latency_optimize: false  # å¯ç”¨å»¶è¿Ÿä¼˜åŒ–
  db_path: ""        # MaxMind GeoIPæ•°æ®åº“è·¯å¾„ï¼ˆå¯é€‰ï¼‰

# è§„åˆ™å¼•æ“é…ç½®ï¼ˆå¯é€‰ï¼‰
rules:
  - name: "block_example"
    priority: 10
    match_domain: ["example.com"]
    action: "block"
    enabled: true
  - name: "route_google_to_ip1"
    priority: 20
    match_domain: ["google.com", "*.google.com"]
    target_ip: "1.2.3.4"
    action: "use_ip"
    enabled: true
```

## ğŸ” å®‰å…¨ç‰¹æ€§

### åŠ å¯†å’Œè®¤è¯
- ğŸ” **ç«¯åˆ°ç«¯åŠ å¯†** - TLS 1.3 + AES-GCM/ChaCha20-Poly1305
- ğŸ”‘ **é¢„å…±äº«å¯†é’¥** - PSKè®¤è¯æœºåˆ¶
- ğŸ” **å¤šç”¨æˆ·è®¤è¯** - Argon2å¯†ç å“ˆå¸Œï¼Œä½¿ç”¨å®‰å…¨çš„éšæœºsalt
- ğŸ”’ **å¯†ç å®‰å…¨** - æ¯ä¸ªç”¨æˆ·ä½¿ç”¨å”¯ä¸€çš„éšæœºsalt

### æµé‡æ··æ·†
- ğŸ­ **SNIä¼ªè£…** - TLSæ¡æ‰‹æ—¶ä½¿ç”¨å¸¸è§åŸŸåSNIï¼ˆcloudflare.com, google.comç­‰ï¼‰
- ğŸ“¦ **åŒ…å¤§å°æ··æ·†** - éšæœºpaddingï¼Œè°ƒæ•´åŒ…å¤§å°åˆ†å¸ƒ
- â±ï¸ **æ—¶é—´æ··æ·†** - éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿæ­£å¸¸è¯·æ±‚æ¨¡å¼
- ğŸ”Œ **ç«¯å£å¤ç”¨** - æœåŠ¡ç«¯ç›‘å¬443ç«¯å£ï¼ˆæ ‡å‡†HTTPSç«¯å£ï¼‰

### é˜²æŠ¤æœºåˆ¶
- ğŸ›¡ï¸ **DDoSé˜²æŠ¤** - è¿æ¥é€Ÿç‡é™åˆ¶å’Œè‡ªåŠ¨é˜»æ­¢
- ğŸš« **IPè¿‡æ»¤** - é»‘ç™½åå•æ”¯æŒ
- ğŸ”’ **é˜²é‡æ”¾æ”»å‡»** - æ—¶é—´æˆ³ + éšæœºæ•°éªŒè¯
- ğŸ›¡ï¸ **é€Ÿç‡é™åˆ¶** - å…¨å±€ã€æŒ‰IPã€æŒ‰ç”¨æˆ·çš„è¿æ¥æ•°å’Œå¸¦å®½é™åˆ¶
- ğŸ”’ **CSRFä¿æŠ¤** - Webç•Œé¢CSRF TokenéªŒè¯
- ğŸ”’ **ç™»å½•ä¿æŠ¤** - é˜²æš´åŠ›ç ´è§£ï¼Œå¤±è´¥5æ¬¡è‡ªåŠ¨é˜»æ­¢15åˆ†é’Ÿ
- â±ï¸ **è¿æ¥è¶…æ—¶ç®¡ç†** - è¯»å†™è¶…æ—¶ã€ç©ºé—²è¿æ¥è‡ªåŠ¨å…³é—­ã€TCP KeepAlive
- ğŸ”„ **ä¼˜é›…å…³é—­** - ç­‰å¾…æ´»è·ƒè¿æ¥å®Œæˆï¼Œå®‰å…¨å…³é—­æœåŠ¡

## ğŸ”§ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.21+
- **åŠ å¯†**: TLS 1.3, AES-GCM (ç¡¬ä»¶åŠ é€Ÿ), ChaCha20-Poly1305
- **ç½‘ç»œ**: iptables + iproute2 (SNAT), Linux splice (é›¶æ‹·è´)
- **åè®®**: è‡ªå®šä¹‰åè®® + SOCKS5, Trojanåè®®æ”¯æŒ
- **Webæ¡†æ¶**: Gorilla Mux
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: Logrus + Lumberjack (æ—¥å¿—è½®è½¬)

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
multiexit-proxy/
â”œâ”€â”€ cmd/                    # å¯æ‰§è¡Œç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ client/            # å®¢æˆ·ç«¯å…¥å£
â”‚   â”œâ”€â”€ server/            # æœåŠ¡ç«¯å…¥å£
â”‚   â”œâ”€â”€ trojan-client/     # Trojanå®¢æˆ·ç«¯
â”‚   â””â”€â”€ trojan-server/     # TrojanæœåŠ¡ç«¯
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ auth/              # ç”¨æˆ·è®¤è¯ï¼ˆArgon2å¯†ç å“ˆå¸Œï¼‰
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†ï¼ˆçƒ­æ›´æ–°ã€ç‰ˆæœ¬ç®¡ç†ã€å¤‡ä»½å›æ»šï¼‰
â”‚   â”œâ”€â”€ logging/           # æ—¥å¿—è½®è½¬
â”‚   â”œâ”€â”€ monitor/           # ç›‘æ§ç»Ÿè®¡ï¼ˆè¿æ¥ã€æµé‡ã€Prometheusï¼‰
â”‚   â”œâ”€â”€ protocol/          # åè®®å®ç°ï¼ˆåŠ å¯†/è§£å¯†ï¼‰
â”‚   â”œâ”€â”€ proxy/             # ä»£ç†æ ¸å¿ƒï¼ˆé›¶æ‹·è´ã€è¿æ¥æ± ã€é™æµï¼‰
â”‚   â”œâ”€â”€ security/          # å®‰å…¨åŠŸèƒ½ï¼ˆDDoSé˜²æŠ¤ã€IPè¿‡æ»¤ï¼‰
â”‚   â”œâ”€â”€ snat/              # SNATç®¡ç†ï¼ˆIPé€‰æ‹©ã€è·¯ç”±ã€å¥åº·æ£€æŸ¥ã€åœ°ç†ä½ç½®ï¼‰
â”‚   â”œâ”€â”€ subscribe/         # è®¢é˜…åŠŸèƒ½
â”‚   â”œâ”€â”€ transport/         # ä¼ è¾“å±‚ï¼ˆTLSã€æµé‡æ··æ·†ï¼‰
â”‚   â”œâ”€â”€ trojan/            # Trojanåè®®å®ç°
â”‚   â””â”€â”€ web/               # Webç®¡ç†ç•Œé¢ï¼ˆCSRFä¿æŠ¤ã€ç™»å½•ä¿æŠ¤ï¼‰
â”œâ”€â”€ pkg/                   # å¯é‡ç”¨åŒ…
â”‚   â”œâ”€â”€ socks5/            # SOCKS5åè®®å®ç°
â”‚   â””â”€â”€ subscribe/         # è®¢é˜…å®¢æˆ·ç«¯
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ deploy/                # éƒ¨ç½²ç›¸å…³æ–‡ä»¶
â”‚   â”œâ”€â”€ server/            # æœåŠ¡ç«¯éƒ¨ç½²æ–‡ä»¶
â”‚   â”œâ”€â”€ client/            # å®¢æˆ·ç«¯éƒ¨ç½²æ–‡ä»¶
â”‚   â”œâ”€â”€ prometheus/        # Prometheusé…ç½®
â”‚   â””â”€â”€ grafana/           # Grafanaä»ªè¡¨æ¿
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ scripts/               # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ docker-compose.yml     # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile             # Dockeré•œåƒæ„å»º
â””â”€â”€ go.mod                 # Goæ¨¡å—å®šä¹‰
```

## âš™ï¸ é…ç½®è¯´æ˜

### æœåŠ¡ç«¯é…ç½® (`configs/server.yaml`)

ä¸»è¦é…ç½®é¡¹ï¼š

```yaml
server:
  listen: ":443"
  tls:
    cert: "/path/to/cert.pem"
    key: "/path/to/key.pem"
    sni_fake: true
    fake_snis:
      - "cloudflare.com"
      - "google.com"

auth:
  method: "psk"
  key: "your-secret-key"

exit_ips:
  - "1.2.3.4"
  - "5.6.7.8"

strategy:
  type: "load_balanced"  # round_robin, destination_based, load_balanced

health_check:
  enabled: true
  interval: "30s"
  timeout: "5s"

ip_detection:
  enabled: true
  interface: ""

connection:
  read_timeout: "30s"
  write_timeout: "30s"
  idle_timeout: "300s"
  dial_timeout: "10s"
  max_connections: 1000
  keep_alive: true

web:
  enabled: true
  listen: ":8080"
  username: "admin"
  password: "admin123"

monitor:
  enabled: true

rate_limit:
  enabled: true
  global_max_connections: 1000
  global_rate_limit: 100
  ip_max_connections: 100
  ip_rate_limit: 50
```

### å®¢æˆ·ç«¯é…ç½® (`configs/client.json`)

```json
{
  "server": {
    "address": "your-server.com:443",
    "sni": "cloudflare.com"
  },
  "auth": {
    "key": "your-secret-key"
  },
  "local": {
    "address": "127.0.0.1:1080"
  },
  "reconnect": {
    "max_retries": 0,
    "initial_delay": "1s",
    "max_delay": "5m",
    "backoff_factor": 2.0,
    "jitter": true
  },
  "pool": {
    "enabled": true,
    "max_size": 10,
    "max_idle": 5,
    "idle_timeout": "5m"
  }
}
```

## ğŸ“ˆ ç›‘æ§å’Œç»Ÿè®¡

### PrometheusæŒ‡æ ‡

æœåŠ¡ç«¯æä¾› `/metrics` ç«¯ç‚¹ï¼Œå¯¼å‡ºæ ‡å‡†PrometheusæŒ‡æ ‡ï¼š

- `multiexit_proxy_total_connections` - æ€»è¿æ¥æ•°
- `multiexit_proxy_active_connections` - æ´»è·ƒè¿æ¥æ•°
- `multiexit_proxy_bytes_up` - ä¸Šè¡Œæµé‡ï¼ˆå­—èŠ‚ï¼‰
- `multiexit_proxy_bytes_down` - ä¸‹è¡Œæµé‡ï¼ˆå­—èŠ‚ï¼‰
- `multiexit_proxy_ip_connections` - æŒ‰IPçš„è¿æ¥æ•°
- `multiexit_proxy_ip_bandwidth` - æŒ‰IPçš„å¸¦å®½

### Grafanaä»ªè¡¨æ¿

ä½¿ç”¨ `deploy/grafana/dashboard.json` å¯¼å…¥Grafanaä»ªè¡¨æ¿ï¼Œå¯è§†åŒ–ç›‘æ§æ•°æ®ã€‚

### Webç•Œé¢ç»Ÿè®¡

è®¿é—®Webç®¡ç†ç•Œé¢æŸ¥çœ‹ï¼š
- å®æ—¶è¿æ¥ç»Ÿè®¡
- IPå¥åº·çŠ¶æ€
- æµé‡åˆ†æï¼ˆæŒ‰åŸŸåï¼‰
- æµé‡è¶‹åŠ¿
- å¼‚å¸¸æ£€æµ‹

## ğŸ”„ é…ç½®ç®¡ç†

### çƒ­æ›´æ–°

é€šè¿‡Webç•Œé¢æˆ–APIæ›´æ–°é…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡ï¼š

```bash
curl -X PUT http://admin:password@YOUR_SERVER:8080/api/config \
  -H "Content-Type: application/json" \
  -d @new-config.json
```

### ç‰ˆæœ¬ç®¡ç†

é…ç½®æ›´æ–°æ—¶è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ç‰ˆæœ¬ï¼Œæ”¯æŒç‰ˆæœ¬åˆ—è¡¨æŸ¥çœ‹å’Œä¸€é”®å›æ»šï¼š

```bash
# æŸ¥çœ‹ç‰ˆæœ¬åˆ—è¡¨
curl http://admin:password@YOUR_SERVER:8080/api/config/versions

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
curl -X POST http://admin:password@YOUR_SERVER:8080/api/config/rollback \
  -H "Content-Type: application/json" \
  -d '{"version": "v1.2.3"}'
```

ç³»ç»Ÿè‡ªåŠ¨ä¿ç•™æœ€è¿‘10ä¸ªé…ç½®ç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬è‡ªåŠ¨æ¸…ç†ã€‚

## ğŸ§ª æµ‹è¯•

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
go test ./...
```

### è¿è¡Œé›†æˆæµ‹è¯•
```bash
cd tests/integration
go test
```

### è¿è¡Œæ€§èƒ½æµ‹è¯•
```bash
cd tests/performance
go test -bench=.
```

## ğŸ“ å¼€å‘

### æ„å»º

```bash
# æ„å»ºæœåŠ¡ç«¯
go build -o server ./cmd/server

# æ„å»ºå®¢æˆ·ç«¯
go build -o client ./cmd/client

# æ„å»ºæ‰€æœ‰
go build ./...
```

### ä»£ç æ£€æŸ¥

```bash
# æ ¼å¼åŒ–ä»£ç 
go fmt ./...

# é™æ€åˆ†æ
go vet ./...

# è¿è¡Œæµ‹è¯•
go test ./...
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼
